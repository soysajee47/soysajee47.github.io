<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçì Memory Match ‚Äì 5 ‡∏î‡πà‡∏≤‡∏ô</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Kanit', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            overflow-x: hidden;
            padding: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
        }

        /* ‚ïê‚ïê‚ïê SCREENS ‚ïê‚ïê‚ïê */
        .screen {
            display: none;
            width: 100%;
            max-width: 620px;
            flex-direction: column;
            align-items: center;
        }

        .screen.active {
            display: flex;
        }

        /* ‚ïê‚ïê‚ïê LEVEL SELECT ‚ïê‚ïê‚ïê */
        #screen-select {
            padding-top: 30px;
            gap: 20px;
        }

        .select-title {
            font-size: clamp(2rem, 6vw, 3rem);
            font-weight: 800;
            background: linear-gradient(135deg, #f093fb, #f5a623, #43e97b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            line-height: 1.2;
        }

        .select-subtitle {
            color: rgba(255, 255, 255, .45);
            font-size: .95rem;
            text-align: center;
            margin-top: 4px;
        }

        .levels-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 14px;
            width: 100%;
            margin-top: 10px;
        }

        .level-card {
            background: rgba(255, 255, 255, .07);
            border: 1px solid rgba(255, 255, 255, .12);
            border-radius: 20px;
            padding: 22px 14px;
            text-align: center;
            cursor: pointer;
            transition: all .25s;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .level-card:hover {
            transform: translateY(-4px);
            background: rgba(255, 255, 255, .13);
            box-shadow: 0 12px 36px rgba(0, 0, 0, .4);
        }

        .level-card .lv-badge {
            position: absolute;
            top: 10px;
            right: 12px;
            font-size: .65rem;
            font-weight: 700;
            letter-spacing: 1px;
            color: rgba(255, 255, 255, .3);
            text-transform: uppercase;
        }

        .level-card .lv-icon {
            font-size: 2.2rem;
            margin-bottom: 6px;
        }

        .level-card .lv-name {
            font-size: 1rem;
            font-weight: 700;
            color: #fff;
            margin-bottom: 2px;
        }

        .level-card .lv-info {
            font-size: .75rem;
            color: rgba(255, 255, 255, .4);
        }

        .level-card .lv-stars {
            font-size: .85rem;
            margin-top: 6px;
            color: #fbd38d;
            letter-spacing: 2px;
        }

        .level-card.locked {
            opacity: .4;
            cursor: not-allowed;
        }

        .level-card.locked:hover {
            transform: none;
        }

        .level-card.completed {
            border-color: rgba(72, 187, 120, .5);
        }

        .level-card.completed .lv-stars {
            color: #48bb78;
        }

        /* ‚ïê‚ïê‚ïê GAME SCREEN ‚ïê‚ïê‚ïê */
        #screen-game {
            padding-top: 16px;
            gap: 14px;
        }

        .game-header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
        }

        .level-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(255, 255, 255, .08);
            border: 1px solid rgba(255, 255, 255, .12);
            border-radius: 50px;
            padding: 6px 14px;
            color: #fff;
            font-weight: 700;
            font-size: .9rem;
        }

        .stats {
            display: flex;
            gap: 10px;
        }

        .stat-box {
            background: rgba(255, 255, 255, .08);
            border: 1px solid rgba(255, 255, 255, .1);
            border-radius: 12px;
            padding: 6px 14px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .stat-box .lbl {
            color: rgba(255, 255, 255, .35);
            font-size: .65rem;
            letter-spacing: .8px;
            text-transform: uppercase;
        }

        .stat-box .val {
            color: #fff;
            font-size: 1.1rem;
            font-weight: 700;
        }

        #timer-val {
            color: #f5a623;
        }

        #pairs-val {
            color: #43e97b;
        }

        #moves-val {
            color: #f093fb;
        }

        /* ‚ïê‚ïê‚ïê GRID ‚ïê‚ïê‚ïê */
        .grid {
            display: grid;
            gap: 10px;
            width: 100%;
        }

        .grid.g4 {
            grid-template-columns: repeat(4, 1fr);
            max-width: 480px;
        }

        .grid.g5 {
            grid-template-columns: repeat(5, 1fr);
            max-width: 560px;
        }

        /* ‚ïê‚ïê‚ïê CARD ‚ïê‚ïê‚ïê */
        .card {
            aspect-ratio: 1;
            cursor: pointer;
            perspective: 600px;
            user-select: none;
        }

        .card-inner {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform .42s cubic-bezier(.4, 0, .2, 1);
            border-radius: 14px;
        }

        .card.flipped .card-inner,
        .card.matched .card-inner {
            transform: rotateY(180deg);
        }

        .card-back,
        .card-front {
            position: absolute;
            inset: 0;
            border-radius: 14px;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card-back {
            background: linear-gradient(135deg, #2d3748, #4a5568);
            border: 2px solid rgba(255, 255, 255, .1);
            font-size: 1.4rem;
            color: rgba(255, 255, 255, .25);
            box-shadow: 0 4px 16px rgba(0, 0, 0, .4);
            transition: background .2s;
        }

        .card:hover:not(.flipped):not(.matched) .card-back {
            background: linear-gradient(135deg, #3d4f69, #5a6a8a);
        }

        .card-front {
            background: linear-gradient(135deg, #fff, #f0f4ff);
            transform: rotateY(180deg);
            border: 2px solid rgba(255, 255, 255, .8);
            box-shadow: 0 6px 24px rgba(0, 0, 0, .25);
            font-size: clamp(1.5rem, 4vw, 2.2rem);
        }

        .card.matched .card-front {
            background: linear-gradient(135deg, #c6f6d5, #9ae6b4);
            border-color: #48bb78;
            box-shadow: 0 0 18px rgba(72, 187, 120, .5);
            animation: matchPop .4s ease;
        }

        @keyframes matchPop {
            0% {
                transform: rotateY(180deg) scale(1)
            }

            50% {
                transform: rotateY(180deg) scale(1.15)
            }

            100% {
                transform: rotateY(180deg) scale(1)
            }
        }

        .card.wrong .card-inner {
            animation: shake .4s ease;
        }

        @keyframes shake {

            0%,
            100% {
                transform: rotateY(180deg) translateX(0)
            }

            20% {
                transform: rotateY(180deg) translateX(-6px)
            }

            40% {
                transform: rotateY(180deg) translateX(6px)
            }

            60% {
                transform: rotateY(180deg) translateX(-5px)
            }

            80% {
                transform: rotateY(180deg) translateX(4px)
            }
        }

        .countdown-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            z-index: 10;
            background: #e53e3e;
            color: #fff;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: .65rem;
            font-weight: 700;
            animation: cPulse 1s infinite;
        }

        @keyframes cPulse {

            0%,
            100% {
                transform: scale(1)
            }

            50% {
                transform: scale(1.2)
            }
        }

        .btn-back {
            background: rgba(255, 255, 255, .07);
            border: 1px solid rgba(255, 255, 255, .12);
            color: rgba(255, 255, 255, .6);
            border-radius: 50px;
            padding: 8px 18px;
            font-family: 'Kanit', sans-serif;
            font-size: .85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all .2s;
        }

        .btn-back:hover {
            background: rgba(255, 255, 255, .14);
            color: #fff;
        }

        /* ‚ïê‚ïê‚ïê WIN OVERLAY ‚ïê‚ïê‚ïê */
        #win-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, .85);
            backdrop-filter: blur(8px);
            z-index: 200;
            align-items: center;
            justify-content: center;
        }

        #win-overlay.show {
            display: flex;
        }

        .win-card {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 1px solid rgba(255, 255, 255, .15);
            border-radius: 28px;
            padding: 36px 44px;
            text-align: center;
            max-width: 380px;
            width: 92%;
            box-shadow: 0 30px 80px rgba(0, 0, 0, .6);
            animation: slideUp .5s cubic-bezier(.34, 1.56, .64, 1);
        }

        @keyframes slideUp {
            from {
                transform: translateY(60px) scale(.8);
                opacity: 0
            }

            to {
                transform: none;
                opacity: 1
            }
        }

        .win-emoji {
            font-size: 3rem;
            margin-bottom: 6px;
        }

        .win-title {
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 4px;
            background: linear-gradient(135deg, #f5a623, #f093fb, #43e97b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .win-sub {
            color: rgba(255, 255, 255, .45);
            font-size: .9rem;
            margin-bottom: 20px;
        }

        .stars {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 18px;
        }

        .star {
            font-size: 2.6rem;
            opacity: 0;
            transform: scale(0) rotate(-30deg);
            animation: starPop .5s cubic-bezier(.34, 1.56, .64, 1) forwards;
        }

        .star:nth-child(1) {
            animation-delay: .2s
        }

        .star:nth-child(2) {
            animation-delay: .4s
        }

        .star:nth-child(3) {
            animation-delay: .6s
        }

        @keyframes starPop {
            to {
                opacity: 1;
                transform: scale(1) rotate(0)
            }
        }

        .win-stats {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-bottom: 22px;
        }

        .win-stat .wlbl {
            color: rgba(255, 255, 255, .35);
            font-size: .65rem;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .win-stat .wval {
            color: #fff;
            font-size: 1.3rem;
            font-weight: 700;
        }

        .score-badge {
            font-size: 2.5rem;
            font-weight: 800;
            margin: 10px 0;
            background: linear-gradient(135deg, #f5a623, #fa709a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .btn-next,
        .btn-replay {
            display: inline-block;
            padding: 12px 32px;
            border: none;
            border-radius: 50px;
            font-family: 'Kanit', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all .2s;
            margin: 4px;
        }

        .btn-next {
            background: linear-gradient(135deg, #43e97b, #38f9d7);
            color: #0f3460;
            box-shadow: 0 8px 20px rgba(67, 233, 123, .35);
        }

        .btn-next:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 28px rgba(67, 233, 123, .45);
        }

        .btn-replay {
            background: linear-gradient(135deg, #f093fb, #f5a623);
            color: #fff;
            box-shadow: 0 8px 20px rgba(240, 147, 251, .35);
        }

        .btn-replay:hover {
            transform: translateY(-2px);
        }

        canvas#fw {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 199;
        }

        @media(max-width:440px) {
            .grid.g4 {
                max-width: 340px;
            }

            .grid.g5 {
                max-width: 420px;
                grid-template-columns: repeat(4, 1fr);
            }

            .win-card {
                padding: 28px 24px;
            }
        }
    </style>
</head>

<body>

    <canvas id="fw"></canvas>

    <!-- ‚ïê‚ïê‚ïê LEVEL SELECT SCREEN ‚ïê‚ïê‚ïê -->
    <div class="screen active" id="screen-select">
        <div class="select-title">üéÆ Memory Match</div>
        <div class="select-subtitle">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô!</div>
        <div class="levels-grid" id="levels-grid"></div>
    </div>

    <!-- ‚ïê‚ïê‚ïê GAME SCREEN ‚ïê‚ïê‚ïê -->
    <div class="screen" id="screen-game">
        <div class="game-header" style="max-width:620px; width:100%;">
            <div style="display:flex; gap:10px; align-items:center;">
                <button class="btn-back" onclick="goSelect()">‚Üê ‡πÄ‡∏°‡∏ô‡∏π</button>
                <div class="level-badge" id="level-badge">‡∏î‡πà‡∏≤‡∏ô 1</div>
            </div>
            <div class="stats">
                <div class="stat-box">
                    <div class="lbl">‚è±</div>
                    <div class="val" id="timer-val">0:00</div>
                </div>
                <div class="stat-box">
                    <div class="lbl">‡∏Ñ‡∏π‡πà</div>
                    <div class="val" id="pairs-val">0/?</div>
                </div>
                <div class="stat-box">
                    <div class="lbl">‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
                    <div class="val" id="moves-val">0</div>
                </div>
            </div>
        </div>
        <div class="grid g4" id="grid"></div>
    </div>

    <!-- ‚ïê‚ïê‚ïê WIN OVERLAY ‚ïê‚ïê‚ïê -->
    <div id="win-overlay">
        <div class="win-card">
            <div class="win-emoji" id="win-emoji">üèÜ</div>
            <div class="win-title" id="win-title">‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°!</div>
            <div class="win-sub" id="win-sub">‡∏ú‡πà‡∏≤‡∏ô‡∏î‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß!</div>
            <div class="stars"><span class="star">‚≠ê</span><span class="star">‚≠ê</span><span class="star">‚≠ê</span></div>
            <div id="perfect-score" style="display:none;">
                <div class="score-badge">üéä 100 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!</div>
                <div style="color:rgba(255,255,255,.5); font-size:.85rem; margin-bottom:12px;">‡∏ú‡πà‡∏≤‡∏ô‡∏Ñ‡∏£‡∏ö‡∏ó‡∏±‡πâ‡∏á 5 ‡∏î‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß!
                </div>
            </div>
            <div class="win-stats">
                <div class="win-stat">
                    <div class="wlbl">‡πÄ‡∏ß‡∏•‡∏≤</div>
                    <div class="wval" id="win-time">-</div>
                </div>
                <div class="win-stat">
                    <div class="wlbl">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
                    <div class="wval" id="win-moves">-</div>
                </div>
            </div>
            <div id="win-btns"></div>
        </div>
    </div>

    <script>
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LEVEL CONFIG ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        const LEVELS = [
            {
                id: 1, name: '‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏™‡∏î', icon: 'üçì', cards: 12, cols: 4,
                desc: '6 ‡∏Ñ‡∏π‡πà ‚Ä¢ ‡∏ú‡∏•‡πÑ‡∏°‡πâ',
                items: ['üçì', 'üçá', 'üçä', 'üçé', 'üçå', 'ü••']
            },
            {
                id: 2, name: '‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏´‡∏ß‡∏≤‡∏ô', icon: 'üçí', cards: 12, cols: 4,
                desc: '6 ‡∏Ñ‡∏π‡πà ‚Ä¢ ‡∏ú‡∏•‡πÑ‡∏°‡πâ',
                items: ['üçí', 'üçç', 'üçâ', 'ü•≠', 'üçê', 'ü•ù']
            },
            {
                id: 3, name: '‡πÇ‡∏•‡∏Å‡∏™‡∏±‡∏ï‡∏ß‡πå', icon: 'üêØ', cards: 16, cols: 4,
                desc: '8 ‡∏Ñ‡∏π‡πà ‚Ä¢ ‡∏™‡∏±‡∏ï‡∏ß‡πå',
                items: ['üêÑ', 'üêØ', 'üêä', 'üêï', 'üê±', 'ü¶ú', 'ü¶≠', 'ü¶ê']
            },
            {
                id: 4, name: '‡∏°‡∏¥‡∏Å‡∏ã‡πå‡∏™‡∏∏‡∏î‡∏°‡∏±‡∏ô', icon: 'ü¶Å', cards: 20, cols: 5,
                desc: '10 ‡∏Ñ‡∏π‡πà ‚Ä¢ ‡∏ú‡∏•‡πÑ‡∏°‡πâ+‡∏™‡∏±‡∏ï‡∏ß‡πå',
                items: ['üçì', 'üçä', 'ü••', 'ü•≠', 'üçé', 'üê±', 'ü¶Å', 'üê¨', 'üêÉ', 'ü¶Ä']
            },
            {
                id: 5, name: '‡∏ú‡∏±‡∏Å‡∏™‡∏î‡πÉ‡∏™', icon: 'ü•ï', cards: 16, cols: 4,
                desc: '8 ‡∏Ñ‡∏π‡πà ‚Ä¢ ‡∏ú‡∏±‡∏Å',
                items: ['ü•í', 'ü•¨', 'ü•ï', 'ü•¶', 'üåø', 'üçÖ', 'üçÜ', 'üçÉ']
            }
        ];

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STATE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        const FLIP_BACK = 1000; // 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        let completedLevels = new Set(JSON.parse(localStorage.getItem('ml_completed') || '[]'));
        let currentLevel = null;
        let flipped = [], matched = 0, moves = 0, totalPairs = 0;
        let canFlip = true, timerInt = null, seconds = 0;
        let particles = [], fwInt = null;

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LEVEL SELECT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function renderSelect() {
            showScreen('screen-select');
            const grid = document.getElementById('levels-grid');
            grid.innerHTML = '';
            LEVELS.forEach((lv, i) => {
                const done = completedLevels.has(lv.id);
                const locked = i > 0 && !completedLevels.has(LEVELS[i - 1].id);
                const div = document.createElement('div');
                div.className = 'level-card' + (done ? ' completed' : '') + (locked ? ' locked' : '');
                div.innerHTML = `
            <div class="lv-badge">LV ${lv.id}</div>
            <div class="lv-icon">${lv.icon}</div>
            <div class="lv-name">${lv.name}</div>
            <div class="lv-info">${lv.desc}</div>
            <div class="lv-stars">${done ? '‚òÖ‚òÖ‚òÖ' : (locked ? 'üîí' : '‚òÜ‚òÜ‚òÜ')}</div>`;
                if (!locked) div.onclick = () => startLevel(lv);
                grid.appendChild(div);
            });
        }

        function goSelect() {
            stopTimer(); renderSelect();
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê START LEVEL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function startLevel(lv) {
            currentLevel = lv;
            flipped = []; matched = 0; moves = 0; canFlip = true; seconds = 0;
            totalPairs = lv.items.length;
            stopTimer();
            document.getElementById('win-overlay').classList.remove('show');

            document.getElementById('level-badge').textContent = `‡∏î‡πà‡∏≤‡∏ô ${lv.id} ‚Äì ${lv.name}`;
            document.getElementById('pairs-val').textContent = `0/${totalPairs}`;
            document.getElementById('moves-val').textContent = '0';
            document.getElementById('timer-val').textContent = '0:00';

            // Grid columns
            const grid = document.getElementById('grid');
            grid.className = 'grid ' + (lv.cols === 5 ? 'g5' : 'g4');

            // Build deck
            const deck = shuffle([...lv.items, ...lv.items]);
            grid.innerHTML = '';
            deck.forEach((emoji, idx) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.emoji = emoji;
                card.dataset.idx = idx;
                card.innerHTML = `<div class="card-inner">
            <div class="card-back">?</div>
            <div class="card-front">${emoji}</div>
        </div>`;
                card.addEventListener('click', () => onFlip(card));
                grid.appendChild(card);
            });

            showScreen('screen-game');
            startTimer();
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FLIP LOGIC ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function onFlip(card) {
            if (!canFlip || card.classList.contains('flipped') || card.classList.contains('matched') || flipped.length >= 2) return;
            card.classList.add('flipped');
            flipped.push(card);
            if (flipped.length === 2) {
                moves++;
                document.getElementById('moves-val').textContent = moves;
                canFlip = false;
                checkMatch();
            }
        }

        function checkMatch() {
            const [a, b] = flipped;
            if (a.dataset.emoji === b.dataset.emoji) {
                setTimeout(() => {
                    a.classList.add('matched'); b.classList.add('matched');
                    matched++;
                    document.getElementById('pairs-val').textContent = `${matched}/${totalPairs}`;
                    flipped = []; canFlip = true;
                    if (matched === totalPairs) onWin();
                }, 350);
            } else {
                a.classList.add('wrong'); b.classList.add('wrong');
                setBadge(a, 1); setBadge(b, 1);
                setTimeout(() => {
                    removeBadge(a); removeBadge(b);
                    a.classList.remove('flipped', 'wrong');
                    b.classList.remove('flipped', 'wrong');
                    flipped = []; canFlip = true;
                }, FLIP_BACK);
            }
        }

        function setBadge(card, n) {
            removeBadge(card);
            const b = document.createElement('div');
            b.className = 'countdown-badge'; b.textContent = n;
            card.style.position = 'relative'; card.appendChild(b);
        }
        function removeBadge(card) {
            const b = card.querySelector('.countdown-badge');
            if (b) b.remove();
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê WIN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function onWin() {
            stopTimer();
            const m = Math.floor(seconds / 60), s = String(seconds % 60).padStart(2, '0');
            completedLevels.add(currentLevel.id);
            localStorage.setItem('ml_completed', JSON.stringify([...completedLevels]));

            const allDone = LEVELS.every(lv => completedLevels.has(lv.id));
            const nextLv = LEVELS.find(lv => lv.id === currentLevel.id + 1);

            document.getElementById('win-time').textContent = `${m}:${s}`;
            document.getElementById('win-moves').textContent = `${moves} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á`;
            document.getElementById('win-title').textContent = allDone ? 'üéä ‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß! üéä' : (currentLevel.id < 5 ? `‡∏ú‡πà‡∏≤‡∏ô‡∏î‡πà‡∏≤‡∏ô ${currentLevel.id}!` : '‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°!');
            document.getElementById('win-sub').textContent = allDone ? '‡∏Ñ‡∏∏‡∏ì‡∏ú‡πà‡∏≤‡∏ô‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏î‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß!' : `‡∏ú‡πà‡∏≤‡∏ô‡∏î‡πà‡∏≤‡∏ô ${currentLevel.id} ‚Äì ${currentLevel.name}`;
            document.getElementById('win-emoji').textContent = allDone ? 'ü•á' : (currentLevel.id < 5 ? 'üèÖ' : 'üèÜ');
            document.getElementById('perfect-score').style.display = allDone ? 'block' : 'none';

            // Buttons
            const btnDiv = document.getElementById('win-btns');
            btnDiv.innerHTML = '';
            if (nextLv) {
                const nb = document.createElement('button');
                nb.className = 'btn-next';
                nb.textContent = `‚ñ∂ ‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà ${nextLv.id}`;
                nb.onclick = () => { hideWin(); startLevel(nextLv); };
                btnDiv.appendChild(nb);
            }
            const rb = document.createElement('button');
            rb.className = 'btn-replay';
            rb.textContent = allDone ? 'üîÑ ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' : 'üîÑ ‡∏î‡πà‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
            rb.onclick = () => {
                if (allDone) { completedLevels.clear(); localStorage.removeItem('ml_completed'); hideWin(); renderSelect(); }
                else { hideWin(); startLevel(currentLevel); }
            };
            btnDiv.appendChild(rb);

            setTimeout(() => {
                document.getElementById('win-overlay').classList.add('show');
                launchFireworks(allDone ? 20 : 10);
            }, 500);
        }

        function hideWin() { document.getElementById('win-overlay').classList.remove('show'); }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TIMER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function startTimer() {
            timerInt = setInterval(() => {
                seconds++;
                document.getElementById('timer-val').textContent = `${Math.floor(seconds / 60)}:${String(seconds % 60).padStart(2, '0')}`;
            }, 1000);
        }
        function stopTimer() { clearInterval(timerInt); timerInt = null; }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HELPERS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function shuffle(arr) {
            const a = [...arr];
            for (let i = a.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1));[a[i], a[j]] = [a[j], a[i]]; }
            return a;
        }
        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FIREWORKS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        const fwCanvas = document.getElementById('fw');
        const fwCtx = fwCanvas.getContext('2d');
        function resizeFW() { fwCanvas.width = window.innerWidth; fwCanvas.height = window.innerHeight; }
        resizeFW(); window.addEventListener('resize', resizeFW);

        function rndColor() { const c = ['#f093fb', '#f5a623', '#43e97b', '#4facfe', '#fa709a', '#fee140', '#a18cd1', '#fbc2eb', '#43c6ac', '#f96854']; return c[Math.floor(Math.random() * c.length)]; }
        function burst(x, y, count = 50) {
            for (let i = 0; i < count; i++) {
                const angle = (Math.PI * 2 / count) * i, speed = 2 + Math.random() * 5;
                particles.push({ x, y, vx: Math.cos(angle) * speed, vy: Math.sin(angle) * speed, alpha: 1, color: rndColor(), size: 2 + Math.random() * 3, g: .09 });
            }
        }
        function animFW() {
            fwCtx.clearRect(0, 0, fwCanvas.width, fwCanvas.height);
            particles.forEach(p => {
                p.x += p.vx; p.y += p.vy; p.vy += p.g; p.alpha -= .016;
                fwCtx.beginPath(); fwCtx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                fwCtx.fillStyle = p.color + Math.floor(p.alpha * 255).toString(16).padStart(2, '0'); fwCtx.fill();
            });
            particles = particles.filter(p => p.alpha > 0);
            if (particles.length > 0 || fwInt) requestAnimationFrame(animFW);
        }
        function launchFireworks(bursts = 10) {
            particles = [];
            let n = 0;
            fwInt = setInterval(() => {
                const x = 80 + Math.random() * (window.innerWidth - 160);
                const y = 60 + Math.random() * (window.innerHeight * .55);
                burst(x, y, 60); n++;
                if (n >= bursts) { clearInterval(fwInt); fwInt = null; }
            }, 300);
            requestAnimationFrame(animFW);
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        renderSelect();
    </script>
</body>

</html>